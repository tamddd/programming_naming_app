<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°ã—ã„å•é¡Œã‚’ä½œæˆ - Naming App</title>
    <link rel="stylesheet" href="/main.css">
    <style>
        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        textarea {
            height: 150px;
            font-family: monospace;
        }

        .option-group {
            border: 1px solid #eee;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <header>
        <h1>æ–°ã—ã„å•é¡Œã‚’ä½œæˆ</h1>
        <nav>
            <a href="/functions">ä¸€è¦§ã«æˆ»ã‚‹</a>
        </nav>
    </header>

    <main>
        <form action="/functions" method="POST">
            <div class="form-group">
                <label for="title">ã‚¿ã‚¤ãƒˆãƒ«</label>
                <input type="text" id="title" name="title" required placeholder="ä¾‹: è¶³ã—ç®—é–¢æ•°">
            </div>

            <div class="form-group">
                <label for="description">èª¬æ˜</label>
                <textarea id="description" name="description" required placeholder="é–¢æ•°ã®èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
            </div>

            <div class="form-group">
                <label for="code">ã‚³ãƒ¼ãƒ‰ (??? ã‚’å«ã‚ã¦ãã ã•ã„)</label>
                <textarea id="code" name="code" required>function ???(a, b) {
  return a + b;
}</textarea>
            </div>

            <h3>é¸æŠè‚¢</h3>
            <div class="option-group">
                <div class="form-group">
                    <label>é¸æŠè‚¢ 1</label>
                    <input type="text" name="option1_value" placeholder="å€¤ (ä¾‹: add)" required>
                    <input type="text" name="option1_text" placeholder="è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ (ä¾‹: add)" required>
                </div>
                <div class="form-group">
                    <label>é¸æŠè‚¢ 2</label>
                    <input type="text" name="option2_value" placeholder="å€¤ (ä¾‹: func)" required>
                    <input type="text" name="option2_text" placeholder="è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ (ä¾‹: func)" required>
                </div>
                <div class="form-group">
                    <label>é¸æŠè‚¢ 3</label>
                    <input type="text" name="option3_value" placeholder="å€¤ (ä¾‹: doSomething)" required>
                    <input type="text" name="option3_text" placeholder="è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ (ä¾‹: doSomething)" required>
                </div>
            </div>

            <div class="form-group">
                <label for="answer">æ­£è§£ã®å€¤</label>
                <input type="text" id="answer" name="answer" required placeholder="ä¾‹: add">
            </div>

            <button type="button" onclick="generateWithAI()" style="background-color: #28a745; margin-right: 10px;">ğŸ¤–
                AIã§ç”Ÿæˆ</button>
            <button type="submit">ä½œæˆã™ã‚‹</button>
        </form>
    </main>

    <script>
        async function generateWithAI() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'ç”Ÿæˆä¸­...';

            try {
                const response = await fetch('/admin/functions/generate', {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error('AI generation failed');
                }

                const text = await response.text();
                // Remove markdown code blocks if present
                let jsonText = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const data = JSON.parse(jsonText);

                // Populate form fields
                document.getElementById('title').value = data.title || '';
                document.getElementById('description').value = data.description || '';
                document.getElementById('code').value = data.code || '';
                document.getElementById('answer').value = data.answer || '';

                // Populate options
                if (data.options && data.options.length >= 3) {
                    document.querySelector('input[name="option1_value"]').value = data.options[0].value || '';
                    document.querySelector('input[name="option1_text"]').value = data.options[0].text || '';
                    document.querySelector('input[name="option2_value"]').value = data.options[1].value || '';
                    document.querySelector('input[name="option2_text"]').value = data.options[1].text || '';
                    document.querySelector('input[name="option3_value"]').value = data.options[2].value || '';
                    document.querySelector('input[name="option3_text"]').value = data.options[2].text || '';
                }

                alert('AIã§å•é¡Œã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼å†…å®¹ã‚’ç¢ºèªã—ã¦ã€Œä½œæˆã™ã‚‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
            } catch (error) {
                alert('AIç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                button.disabled = false;
                button.textContent = 'ğŸ¤– AIã§ç”Ÿæˆ';
            }
        }
    </script>
</body>

</html>